<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">lib/proxy.js | redux-idle-monitor API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/cchamberlain/redux-webpack-boilerplate" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getCors">getCors</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-proxy">proxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-readCertificate">readCertificate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-readPfx">readPfx</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getServerMap">getServerMap</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-configureServer">configureServer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-devStream">devStream</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-voidStream">voidStream</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">redux</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hydrateImmutable">hydrateImmutable</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ACTIVE_SESSION">ACTIVE_SESSION</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ADD_ERROR">ADD_ERROR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AUTHORIZE_MIDDLEWARE">AUTHORIZE_MIDDLEWARE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CLEAR_DATA">CLEAR_DATA</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CLEAR_ERRORS">CLEAR_ERRORS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CLEAR_SUGGESTIONS">CLEAR_SUGGESTIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CLEAR_VALIDATED">CLEAR_VALIDATED</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DISMISS_ERROR">DISMISS_ERROR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DISPOSE_TOOLTIP">DISPOSE_TOOLTIP</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-EXPIRED_SESSION">EXPIRED_SESSION</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FETCH_AUTHORIZE_IDENTITY">FETCH_AUTHORIZE_IDENTITY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FETCH_DATA">FETCH_DATA</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FETCH_IDENTITY">FETCH_IDENTITY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FETCH_IMPERSONATE_IDENTITY">FETCH_IMPERSONATE_IDENTITY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FETCH_MONIKERS">FETCH_MONIKERS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FETCH_REFRESH_IDENTITY">FETCH_REFRESH_IDENTITY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FETCH_SUGGESTIONS">FETCH_SUGGESTIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FILTER_SUGGESTIONS">FILTER_SUGGESTIONS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FORGET_FINGERPRINT">FORGET_FINGERPRINT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FORGET_TOKENS">FORGET_TOKENS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FORGOTTEN_FINGERPRINT">FORGOTTEN_FINGERPRINT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FORGOTTEN_TOKENS">FORGOTTEN_TOKENS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-HYDRATE_FINGERPRINT">HYDRATE_FINGERPRINT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-HYDRATE_IDENTITY">HYDRATE_IDENTITY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-HYDRATE_TOKENS">HYDRATE_TOKENS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-IDENTITY_EXPIRED">IDENTITY_EXPIRED</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-IDENTITY_INVALID">IDENTITY_INVALID</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-INACTIVE_SESSION">INACTIVE_SESSION</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-KEYED_DATA">KEYED_DATA</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PERSISTED_FINGERPRINT">PERSISTED_FINGERPRINT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PERSISTED_TOKENS">PERSISTED_TOKENS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-POST_AUTHORIZE">POST_AUTHORIZE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-POST_AUTHORIZE_ADMIN">POST_AUTHORIZE_ADMIN</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RECEIVE_AUTHORIZE_IDENTITY">RECEIVE_AUTHORIZE_IDENTITY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RECEIVE_DATA">RECEIVE_DATA</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RECEIVE_IMPERSONATE_IDENTITY">RECEIVE_IMPERSONATE_IDENTITY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RECEIVE_MONIKERS">RECEIVE_MONIKERS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RECEIVE_REFRESH_IDENTITY">RECEIVE_REFRESH_IDENTITY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-REGISTER_TOOLTIP">REGISTER_TOOLTIP</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SET_EXPANDER">SET_EXPANDER</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SET_IDENTITY">SET_IDENTITY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SET_SESSION_TIMEOUTS">SET_SESSION_TIMEOUTS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SET_TEXT">SET_TEXT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SET_THEME">SET_THEME</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SET_VALIDATED">SET_VALIDATED</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SET_VISIBILITY">SET_VISIBILITY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TOGGLE_EXPANDER">TOGGLE_EXPANDER</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-TOGGLE_VISIBILITY">TOGGLE_VISIBILITY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-UPDATE_INPUT_VALUE">UPDATE_INPUT_VALUE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-HYDRATE">HYDRATE</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">redux/reducers</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-api">api</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-autocomplete">autocomplete</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-errors">errors</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-identity">identity</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-validation">validation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-visual">visual</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-initialState">initialState</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">redux/store</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-configureStore">configureStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-configureStore">configureStore</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">router</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-configureApiRouter">configureApiRouter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-configureAppRouter">configureAppRouter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-configureRouter">configureRouter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-configureSecureRouter">configureSecureRouter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-configureUnsupportedRouter">configureUnsupportedRouter</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">routes</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-configureRoutes">configureRoutes</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">routes/Identity/routes/Login/components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/Identity/routes/Login/components/Login.js~Login.html">Login</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">routes/Identity/routes/Maintenance/components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/Identity/routes/Maintenance/components/Maintenance.js~Maintenance.html">Maintenance</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">routes/NoMatch/components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/NoMatch/components/NoMatch.js~NoMatch.html">NoMatch</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">routes/components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/components/App.js~App.html">App</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/components/Index.js~Index.html">Index</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/proxy.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/***
 * Proxy Module
 * Responsible for reading proxy config and setting up proxies.
 * @module server/proxy
 */
import httpProxy from &apos;http-proxy&apos;
import http from &apos;http&apos;
import https from &apos;https&apos;
import { server as serverConfig, log } from &apos;../config&apos;

const proxyListen = ({ name, fromPort, toHost, toPort }) =&gt; `proxy ${name} directing from :${fromPort} to ${toHost}:${toPort}`

export default function proxy() {
  const cdnBindings = new Map(serverConfig.bindings.cdn)
  const hasHttp = cdnBindings.has(&apos;http&apos;)
  const hasHttps = cdnBindings.has(&apos;https&apos;)
  //const cors = getCors()
  const proxyConfigs = Array.isArray(serverConfig.proxies) ? serverConfig.proxies : [ serverConfig.proxies ]
  if(proxyConfigs.length === 0)
    return

  /*** Iterate proxy configs and start routing */
  proxyConfigs.forEach(config =&gt; {
    const options = getProxyOptions(config)
    const proxyServer = httpProxy.createProxyServer(options)
    const listenMessage = proxyListen(config)

    proxyServer.on(&apos;error&apos;, (err, req, res) =&gt; {
      log.error(err, &apos;error proxying request&apos;)
      res.end()
    })

    proxyServer.on(&apos;proxyReq&apos;, (proxyReq, req, res, options) =&gt; { /* This event fires on proxy requests */ })


    createProxyServer(http.createServer(onProxy))

    const createProxyServer = server =&gt; {
      if (config.allowWebSockets)
        server.on(&apos;upgrade&apos;, (req, socket, head) =&gt; server.ws(req, socket, head))
      server.listen(config.fromPort, () =&gt; log.info(listenMessage))
    }

    const onProxy = (req, res) =&gt; {
      //if(!cors.isOk(req))
        //return cors.handleFailure(req, res)

      if(config.stub &amp;&amp; config.stub[req.method])
        return proxyStub(req, res)

      if(req.method === &apos;OPTIONS&apos;)
        //return cors.handlePreflight(req, res)

      if (config.latency)
        setTimeout(() =&gt; proxyServer.web(req, res), config.latency)
      else
        proxyServer.web(req, res)
    }

    const proxyStub = (req, res) =&gt; {
      var stub = config.stub[req.method]
      res.writeHead(200, stub.headers)
      if (stub.headers[&apos;content-length&apos;] === 0) res.end()
      else res.end(JSON.stringify(stub.body))
    }
  })
}

const getProxyOptions = config =&gt; {
  var opts =  { target: config.target || `${config.toScheme}://${config.toHost}:config.toPort`
              , xfwd: true
              }
  opts.secure = config.secure
  return opts
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.6)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
